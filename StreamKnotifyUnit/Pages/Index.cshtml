@page "/"
@using StreamKnotifyUnit.Services;
@using Kendo.Blazor.Components.TabStrip;
@using StreamKnotifyUnit.Shared;
@inject StreamKnotifyUnit.Services.TwitchService Twitchy;
@inject ToastService Toasty;

<h1>Hello, JT7 SKU Community!</h1>
<select bind=@tabPosition>
    <option value=@KendoTabPosition.Top>Top</option>
    <option value=@KendoTabPosition.Left>Left</option>
    <option value=@KendoTabPosition.Right>Right</option>
    <option value=@KendoTabPosition.Bottom>Bottom</option>
</select>

<KendoTabStrip TabPosition=@tabPosition>
    <KendoTab Title="Followers">
        <KendoGrid Data="FollowerData" Height="@Height">
            <KendoGridColumns>
                <KendoGridColumn Field="@nameof(Follower.TimeStamp)" Title="Time" />
                <KendoGridColumn Field="@nameof(Follower.User)" Title="Username" />
                <KendoGridColumn Field="@nameof(Follower.Follow)" Title="Follow" />
            </KendoGridColumns>
        </KendoGrid>
    </KendoTab>
    <KendoTab Title="Subscribers">
        <KendoGrid Data="SubsData" Height="@Height">
            <KendoGridColumns>
                <KendoGridColumn Field="@nameof(Subscriber.TimeStamp)" Title="Time" />
                <KendoGridColumn Field="@nameof(Subscriber.User)" Title="Username" />
                <KendoGridColumn Field="@nameof(Subscriber.SubscribeType)" Title="Tier Sub" />
                <KendoGridColumn Field="@nameof(Subscriber.StreakMonths)" Title="Streak" />
                <KendoGridColumn Field="@nameof(Subscriber.CumulativeMonths)" Title="Overal Subbed" />
            </KendoGridColumns>
        </KendoGrid>
    </KendoTab>
    <KendoTab Title="Tips">
        <KendoGrid Data="TipsData" Height="@Height">
            <KendoGridColumns>
                <KendoGridColumn Field="@nameof(Tip.Message.TimeStamp)" Title="Time" />
                <KendoGridColumn Field="@nameof(Tip.User)" Title="Username" />
                <KendoGridColumn Field="@nameof(Tip.Amount)" Title="Tier Sub" />
                <KendoGridColumn Field="@nameof(Tip.Message.Context)" Title="Streak" />
            </KendoGridColumns>
        </KendoGrid>
    </KendoTab>
    <KendoTab Title="Bits Cheered">
        <KendoGrid Data="CheerData" Height="@Height">
            <KendoGridColumns>
                <KendoGridColumn Field="@nameof(Cheer.Message.TimeStamp)" Title="Time" />
                <KendoGridColumn Field="@nameof(Cheer.User)" Title="Username" />
                <KendoGridColumn Field="@nameof(Cheer.Amount)" Title="Cheered" />
                <KendoGridColumn Field="@nameof(Cheer.Message.Context)" Title="Message" />
            </KendoGridColumns>
        </KendoGrid>
    </KendoTab>
</KendoTabStrip>

<KendoButton class=" btn btn-info" onclick="@(() => Toasty.ShowToast("I'm an INFO message", ToastLevel.NewCheer))">Cheer Toast</KendoButton>
    <KendoButton class="btn btn-success" onclick="@(() => Toasty.ShowToast("I'm a SUCCESS message", ToastLevel.NewFollower))">Success Toast</KendoButton>
    <KendoButton class="btn btn-warning" onclick="@(() => Toasty.ShowToast("I'm a WARNING message", ToastLevel.NewSubscriber))">Warning Toast</KendoButton>
    <KendoButton class="btn btn-danger" onclick="@(() => Toasty.ShowToast("I'm an ERROR message", ToastLevel.NewTip))">Error Toast</KendoButton>
@functions {
    KendoTabPosition tabPosition = KendoTabPosition.Top;
    public List<Follower> FollowerData { get; set; }
    public List<Subscriber> SubsData { get; set; }
    public List<Tip> TipsData { get; set; }
    public List<Cheer> CheerData { get; set; }
    public decimal Height { get; set; }


    protected override async Task OnInitAsync()
    {
        await LoadData();
        Height = 300;
    }

    private async Task LoadData()
    {
        FollowerData = await Twitchy.GetFollowersAsync();
        SubsData = await Twitchy.GetSubscribersAsync();
        TipsData = await Twitchy.GetTipperssAsync();
        CheerData = await Twitchy.GetCheerersAsync();
    }
}